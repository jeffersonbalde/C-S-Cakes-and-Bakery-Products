;/*FB_PKG_DELIM*/

__d("LSUpdateCMThreadSnippet",["LSGetThreadParticipantDisplayName"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return c.resolve((d[1]="",d[0]=d[1]===""?void 0:d[1]))},function(e){return d[0]!==void 0?c.forEach(c.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({snippet:d[0],snippetStringHash:void 0,snippetStringArgument1:void 0,snippetAttribution:void 0,snippetAttributionStringHash:void 0,isAdminSnippet:a[2],snippetSenderContactId:a[3],snippetHasEmoji:a[4],viewedPluginKey:a[5],viewedPluginContext:a[6]})}):a[7]?c.sequence([function(e){return c.i64.neq(a[3],void 0)?c.sequence([function(e){return c.storedProcedure(b("LSGetThreadParticipantDisplayName"),a[0],a[3]).then(function(a){return a=a,d[2]=a[0],a})},function(a){return c.localizeV2Async(c.i64.cast([0,14617150]),void 0).then(function(a){return d[3]=a})},function(b){return d[2]===""||d[2]===d[3]?d[4]=void 0:d[4]=d[2],a[1]!==void 0?(d[4]!==void 0?d[6]=[d[4],": ",a[1]].join(""):d[6]=a[1],d[5]=d[6]):d[5]=void 0,d[1]=d[5]}]):c.resolve(d[1]=a[1])},function(b){return c.forEach(c.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({snippet:d[1],snippetStringHash:void 0,snippetStringArgument1:void 0,snippetAttribution:void 0,snippetAttributionStringHash:void 0,isAdminSnippet:a[2],snippetSenderContactId:a[3],snippetHasEmoji:a[4],viewedPluginKey:a[5],viewedPluginContext:a[6]})})}]):c.forEach(c.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({snippet:a[1],snippetStringHash:void 0,snippetStringArgument1:void 0,snippetAttribution:void 0,snippetAttributionStringHash:void 0,isAdminSnippet:a[2],snippetSenderContactId:a[3],snippetHasEmoji:a[4],viewedPluginKey:a[5],viewedPluginContext:a[6]})})}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSVerifyAndUpsertThreadQueueSequenceID",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(b){return c.db.table(294).fetch([[[a[0]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[0]=c.i64.cast([0,0]):(b=a.item,d[0]=b.threadQueueSequenceId)})},function(e){return c.i64.lt(c.i64.add(d[0],c.i64.cast([0,1])),a[1])?(d[2]=new c.Map(),d[2].set("thread_id",a[0]),d[2].set("previous_tq_seq_id",d[0]),d[2].set("current_tq_seq_id",a[1]),d[2].set("delta_type",a[2]),d[3]=d[2].get("thread_id"),d[2],d[4]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewTask"),["cm_thread_hole_detection",c.i64.to_string(d[3])].join(""),c.i64.cast([0,501]),d[4],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):c.resolve()},function(b){return c.i64.gt(a[1],d[0])?c.db.table(294).fetch([[[a[0]]]]).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(294).add({threadKey:a[0],threadQueueSequenceId:a[1]}):(b.item,c.forEach(c.db.table(294).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({threadQueueSequenceId:a[1]})}))}):c.resolve()}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSVerifyThreadPendingLazyLoading",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.db.table(13).fetch([[[a[0],b.i64.cast([2328,1316134911])]]]),function(c){var d=c.item;return b.forEach(b.filter(b.db.table(13).fetch([[[d.threadKey,d.minTimestampMs,d.minMessageId]]]),function(a){return b.i64.eq(a.threadKey,d.threadKey)&&b.i64.eq(b.i64.cast([0,0]),b.i64.cast([0,0]))&&b.i64.eq(a.minTimestampMs,d.minTimestampMs)&&a.minMessageId===d.minMessageId}),function(b){var c=b.update;b.item;return c({minTimestampMs:a[2],minMessageId:a[1]})})})},function(a){return b.resolve(c)}])}e.exports=a}),null);