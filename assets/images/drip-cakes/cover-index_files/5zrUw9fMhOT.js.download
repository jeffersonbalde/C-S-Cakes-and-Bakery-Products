;/*FB_PKG_DELIM*/

__d("useMWPThreadPointQueryOneToOneCutoverThreadThenNavigate",["I64","LSFactory","LSPlatformWaitForTaskCompletion","LSThreadPointQueryAndRestoreMessagesWithJIDStoredProcedure","MAWJids","MAWJobDefinitions","MAWTimedJob","ReQL","WAJobOrchestratorTypes","WALoggerDeferred","asyncToGeneratorRuntime","promiseDone","react","useAsyncReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Thread-Point-Query][OD-Cutover] LSThreadPointQueryAndRestoreMessagesWithJID finished with an error for ThreadKey: ","\nError: ",""],["[Thread-Point-Query][OD-Cutover] LSThreadPointQueryAndRestoreMessagesWithJID finished with an error for ThreadKey: ","\\nError: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Thread-Point-Query][OD-Cutover] LSThreadPointQueryAndRestoreMessagesWithJID finished successfully for ThreadKey: ",""]);k=function(){return a};return a}var l=(h||d("react")).useCallback;function a(){var a=c("useAsyncReStore")();return l(function(e,f){c("promiseDone")(a,function(a){var g=d("ReQL").fromTableAscending(a.table("mi_act_mapping_table").index("jid")).getKeyRange(e);g.subscribe(function(){var h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,h){b=h.operation;if(b==="delete")return;h=(yield d("ReQL").firstAsync(g));if(h==null)return;b=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("threads")).getKeyRange(h.serverThreadKey)));if(b==null)return;h=b.clientThreadKey;var j=b.threadKey;b=b.threadType;c("promiseDone")(d("MAWTimedJob").TimedUIJobStarters.waitUntilPersisted(d("MAWJobDefinitions").createStartJobInfo("getDevices",{ignoreDhash:!1,reason:"thread-point-querying-1-to-1-thread",scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},users:new Set().add(d("MAWJids").toUserJid((i||(i=d("I64"))).to_string(e)))})));f.openTabOrInbox({clientThreadKey:h,threadKey:j,threadType:b},"preCutoverThread")});return function(a,b){return h.apply(this,arguments)}}());c("LSPlatformWaitForTaskCompletion")(a,function(a){return c("LSThreadPointQueryAndRestoreMessagesWithJIDStoredProcedure")(c("LSFactory")(a),{waJid:e})},"readwrite").then(function(){c("promiseDone")(d("WALoggerDeferred").LOG(k(),(i||(i=d("I64"))).to_string(e)))})["catch"](function(a){c("promiseDone")(d("WALoggerDeferred").LOG(j(),(i||(i=d("I64"))).to_string(e),a))})})},[a])}g["default"]=a}),98);
__d("useMAWCanThreadBeCutover",["LSContactBitOffset","ReQL","ReQLSuspense","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b=(h||(h=c("useReStore")))(),e=d("ReQLSuspense").useArray(function(){return d("ReQL").leftJoin(d("ReQL").fromTableAscending(b.table("participants"),[]).getKeyRange(a),d("ReQL").fromTableAscending(b.table("contacts"),["capabilities","capabilities2"]))},[b,a],f.id+":26");return e.every(function(a){a[0];a=a[1];return a!=null&&d("LSContactBitOffset").has(75,a)===!0})}g["default"]=a}),98);
__d("useMAWCanThreadBeCutoverOnDemand",["LSContactBitOffset","LSMessagingThreadTypeUtil","MAWThreadCutover","ReQL","ReQLSuspense","useMAWCanThreadBeCutover","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b=(h||(h=c("useReStore")))(),e=d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableAscending(b.table("contacts")).getKeyRange(a)},[b,a],f.id+":34");e=e!=null&&d("LSContactBitOffset").has(76,e);var g=d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableAscending(b.table("threads")).getKeyRange(a)},[b,a],f.id+":47");g=g?d("LSMessagingThreadTypeUtil").isOpenOneToOne(g.threadType):!1;var i=d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableAscending(b.table("mi_act_mapping_table").index("jid")).getKeyRange(a)},[b,a],f.id+":54");i=i!=null;var j=d("MAWThreadCutover").useIsCutoverOpenThread(a),k=d("MAWThreadCutover").useIsCutoverSecureThread(a);j=j||k;k=c("useMAWCanThreadBeCutover")(a);return e&&g&&!i&&!j&&k}g["default"]=a}),98);
__d("useMAWTriggerOnDemandCutover",["I64","Int64Hooks","LSFactory","LSPlatformWaitForTaskCompletion","LSThreadPointQueryAndRestoreMessagesWithJIDStoredProcedure","WALoggerDeferred","promiseDone","react","useMAWCanThreadBeCutoverOnDemand","useMWNavigation","useMWPThreadPointQueryOneToOneCutoverThreadThenNavigate","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[OD-Cutover] Cutover finished with an error for ThreadKey: ",".\nError: ",""],["[OD-Cutover] Cutover finished with an error for ThreadKey: ",".\\nError: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[OD-Cutover] Cutover finished successfully for ThreadKey: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[OD-Cutover] Triggering cutover for ThreadKey: ",""]);m=function(){return a};return a}b=j||d("react");var n=b.useRef,o=b.useState;function a(a){var b=a.threadKey,e=a.triggerSource,f=(h||(h=c("useReStore")))(),g=c("useMAWCanThreadBeCutoverOnDemand")(b),j=n(null);a=o(!1);var p=a[0],q=a[1],r=c("useMWNavigation")(),s=c("useMWPThreadPointQueryOneToOneCutoverThreadThenNavigate")();d("Int64Hooks").useEffectInt64(function(){var a=j.current==null||j.current!==g;a&&g&&(j.current=g,q(!0),c("promiseDone")(d("WALoggerDeferred").LOG(m(),(i||(i=d("I64"))).to_string(b))),e==="inbox"?s&&s(b,r):c("LSPlatformWaitForTaskCompletion")(f,function(a){return c("LSThreadPointQueryAndRestoreMessagesWithJIDStoredProcedure")(c("LSFactory")(a),{waJid:b})},"readwrite").then(function(){c("promiseDone")(d("WALoggerDeferred").LOG(l(),(i||(i=d("I64"))).to_string(b)))})["catch"](function(a){c("promiseDone")(d("WALoggerDeferred").LOG(k(),(i||(i=d("I64"))).to_string(b),a))})["finally"](function(){q(!1)}))},[g,f,r,b,s,e]);return p}g["default"]=a}),98);